# ðŸ—ï¸ Bug Reproduction Agent - Architecture

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Interface Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CLI Interface       â”‚      â”‚  Programmatic API           â”‚ â”‚
â”‚  â”‚  (reproduce_bug_cli) â”‚      â”‚  (BugReproductionAgent)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LangGraph Orchestration                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    State Management                         â”‚ â”‚
â”‚  â”‚  â€¢ AgentState (TypedDict)                                  â”‚ â”‚
â”‚  â”‚  â€¢ Pydantic Models (JiraIssueDetails, ReproductionPlan)   â”‚ â”‚
â”‚  â”‚  â€¢ Message History & Error Tracking                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Parser   â”‚â”€â”€â”€>â”‚  Planner  â”‚â”€â”€â”€>â”‚ Executor  â”‚â”€â”€â”€>â”‚ Report â”‚ â”‚
â”‚  â”‚   Node    â”‚    â”‚   Node    â”‚    â”‚   Node    â”‚    â”‚  Node  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                  â”‚                 â”‚              â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                 â”‚              â”‚
        â†“                  â†“                 â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI & Integration Layer                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Claude Sonnet 4.0 (Anthropic API)            â”‚  â”‚
â”‚  â”‚  â€¢ Parse JIRA issues                                    â”‚  â”‚
â”‚  â”‚  â€¢ Create reproduction plans                            â”‚  â”‚
â”‚  â”‚  â€¢ Simulate step execution                              â”‚  â”‚
â”‚  â”‚  â€¢ Analyze results                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  JIRA Client     â”‚         â”‚  GitHub Client (Optional) â”‚   â”‚
â”‚  â”‚  â€¢ Fetch issues  â”‚         â”‚  â€¢ Get commits            â”‚   â”‚
â”‚  â”‚  â€¢ Add comments  â”‚         â”‚  â€¢ Fetch code             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Node Architecture

### 1. JIRA Parser Node
```
Input:  jira_issue_key
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fetch JIRA Issue       â”‚
â”‚  (SimpleJiraClient)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Parse with Claude      â”‚
â”‚  â€¢ Extract steps        â”‚
â”‚  â€¢ Identify behavior    â”‚
â”‚  â€¢ Parse app details    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
Output: JiraIssueDetails
```

### 2. Reproduction Planner Node
```
Input:  JiraIssueDetails
        code_files (optional)
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analyze Issue          â”‚
â”‚  â€¢ Review steps         â”‚
â”‚  â€¢ Consider context     â”‚
â”‚  â€¢ Identify gaps        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Plan (Claude)   â”‚
â”‚  â€¢ Prerequisites        â”‚
â”‚  â€¢ Environment setup    â”‚
â”‚  â€¢ Atomic steps         â”‚
â”‚  â€¢ Verification points  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validate Plan          â”‚
â”‚  â€¢ Check completeness   â”‚
â”‚  â€¢ Verify steps         â”‚
â”‚  â€¢ Log warnings         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
Output: ReproductionPlan
```

### 3. Execution Node
```
Input:  ReproductionPlan
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  For Each Step:         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Simulate Executionâ”‚  â”‚
â”‚  â”‚ (Claude)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Capture Result    â”‚  â”‚
â”‚  â”‚ â€¢ Status          â”‚  â”‚
â”‚  â”‚ â€¢ Actual outcome  â”‚  â”‚
â”‚  â”‚ â€¢ Errors          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Update Context    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analyze Results        â”‚
â”‚  (Claude)               â”‚
â”‚  â€¢ Determine success    â”‚
â”‚  â€¢ Root cause analysis  â”‚
â”‚  â€¢ Recommendations      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
Output: ReproductionResult
```

### 4. Report Node
```
Input:  ReproductionResult
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Format Report          â”‚
â”‚  â€¢ Summary              â”‚
â”‚  â€¢ Detailed steps       â”‚
â”‚  â€¢ Analysis             â”‚
â”‚  â€¢ Recommendations      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save Results           â”‚
â”‚  â€¢ JSON file            â”‚
â”‚  â€¢ Structured data      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Post to JIRA?          â”‚
â”‚  (if enabled)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
Output: Final State
```

## Data Flow

```
User Input (Issue Key)
    â”‚
    â”œâ”€> JIRA API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Raw Issue Data
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                          Claude Sonnet 4.0
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                         Structured Data
    â”‚                         (JiraIssueDetails)
    â”‚                                â”‚
    â”œâ”€> Code Files (Optional) â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                          Claude Sonnet 4.0
    â”‚                          (Plan Creation)
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                         Reproduction Plan
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                         Step-by-Step
    â”‚                         Simulation
    â”‚                         (Claude for each)
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                         Execution Results
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                          Claude Sonnet 4.0
    â”‚                          (Analysis)
    â”‚                                â”‚
    â”‚                                â†“
    â”‚                         Final Report
    â”‚                                â”‚
    â”œâ”€> Save to JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                â”‚
    â””â”€> Display in CLI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Transitions

```
initializing
    â†“
fetching â”€â”€[error]â”€â”€> failed
    â†“
parsing â”€â”€[error]â”€â”€> failed
    â†“
parsed
    â†“
planning â”€â”€[error]â”€â”€> failed
    â†“
planned
    â†“
executing â”€â”€[error]â”€â”€> failed
    â†“
analyzing â”€â”€[error]â”€â”€> failed
    â†“
completed
    â†“
report
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BugReproductionAgent                   â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              LangGraph StateGraph                 â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  Nodes:                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ JiraParserNode                                â”‚   â”‚
â”‚  â”‚  â”œâ”€ ReproductionPlannerNode                       â”‚   â”‚
â”‚  â”‚  â”œâ”€ ExecutionNode                                 â”‚   â”‚
â”‚  â”‚  â””â”€ ReportNode                                    â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  Edges:                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ entry -> fetch_and_parse                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ fetch_and_parse -> [create_plan | abort]     â”‚   â”‚
â”‚  â”‚  â”œâ”€ create_plan -> [execute | abort]             â”‚   â”‚
â”‚  â”‚  â”œâ”€ execute -> [report | abort]                  â”‚   â”‚
â”‚  â”‚  â””â”€ report -> END                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack Details

### Core Framework
- **LangGraph**: Agentic workflow orchestration
- **LangChain**: Base framework for LLM integration
- **Anthropic SDK**: Direct API access to Claude

### Data Validation
- **Pydantic**: Type-safe data models
- **TypedDict**: State type checking

### External APIs
- **JIRA REST API v3**: Issue management
- **GitHub API v3**: Code context (optional)
- **Anthropic API**: Claude Sonnet 4.0

### UI/UX
- **Rich**: Terminal formatting and progress
- **argparse**: CLI argument parsing

### Utilities
- **python-dotenv**: Environment configuration
- **requests**: HTTP client for APIs
- **json**: Data serialization

## Extensibility Points

### 1. Custom Nodes
Add new nodes to the workflow:
```python
class CustomNode:
    def __call__(self, state: AgentState) -> AgentState:
        # Your custom logic
        return state

workflow.add_node("custom", CustomNode())
```

### 2. Alternative LLMs
Swap Claude for other models:
```python
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model="gpt-4")
```

### 3. Real Execution
Replace simulation with actual execution:
```python
from selenium import webdriver

driver = webdriver.Chrome()
# Actual browser automation
```

### 4. Custom Routers
Add conditional logic:
```python
def custom_router(state: AgentState) -> str:
    if state["some_condition"]:
        return "path_a"
    return "path_b"

workflow.add_conditional_edges("node", custom_router, {...})
```

---

This architecture enables:
âœ… Scalable agentic workflows
âœ… Type-safe state management  
âœ… Easy extensibility
âœ… Clear separation of concerns
âœ… Comprehensive error handling
